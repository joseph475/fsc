var DirectoryView=Backbone.View.extend({el:$("#options-list-view"),_href:$(".report-print").attr("href"),_href2:$(".report-print2").attr("href"),initialize:function(){$(".sortcolumn").css("cursor","pointer");if(this.options.status_id==undefined){}this.collection.isLoading=false;this.collection.status_id=1;this.collection.on("add",this.renderOptions,this);this.collection.on("reset",this.render,this);this.collection.on("fetch",function(){this.collection.isLoading=true;$("#loader-container").html('<img src="'+BASE_URL+'includes/img/ajax-loader.gif" />')},this);this.showStatus();this.filterby()},events:{"change #option":"filterby","click .sortcolumn":"updateSortBy","change #vessel_id":"toggleSearch","click #submit-search":"toggleSearch","click #loadmore-options":"loadMore","focus .ddate":"embdate","focus .monthPicker":"monthpicker"},filterby:function(c){if($("#option").val()==0){this.$el.find(".bydate").show();this.$el.find(".monthPicker").hide()}else{if($("#option").val()==1){this.$el.find(".bydate").hide();this.$el.find(".monthPicker").show();var b=new Date();var a=["January","February","March","April","May","June","July","August","September","October","November","December"];$(".monthPicker").val(a[b.getMonth()]+"-"+b.getFullYear())}}},loadMore:function(a){this.collection.requestNextPage()},toggleSearch:function(d){d.preventDefault();$("#options-table-1 tbody").empty();this.collection.currentPage=1;this.collection.vessel_id=$("#vessel_id").val();if($("#option").val()==0){if(!$("#date1").val()||!$("#date2").val()){alert=new AlertView({type:"error",message:"Please select a Date to filter."});alert.render()}else{this.collection.date1=$("#date1").val();this.collection.date2=$("#date2").val()}}else{if($("#option").val()==1){if(!$("#month").val()){alert=new AlertView({type:"error",message:"Please select a Date to filter."});alert.render()}else{var a=Date.parse($("#month").val());var c=new Date(a.getFullYear(),a.getMonth(),1);var b=new Date(a.getFullYear(),a.getMonth()+1,0);this.collection.date1=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate();this.collection.date2=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()}}}this.collection.pager();$(".report-print").attr("href",this._href+"/"+$("#vessel_id").val()+"/"+$("#option").val()+"/"+this.collection.date1+"/"+this.collection.date2);$(".report-print2").attr("href",this._href2+"/"+$("#vessel_id").val()+"/"+$("#option").val()+"/"+this.collection.date1+"/"+this.collection.date2)},updateSortBy:function(a){if(this.collection.sortDir=="desc"){dir="asc"}else{dir="desc"}this.collection.sortDir=String(dir);this.collection.updateOrder($(a.target).attr("col"))},showStatus:function(b){window.location.hash="/status/1";var a=this.collection;a.status_id=1;a.currentPage=0;a.pager()},render:function(){var a=this;$("#loader-container").empty();this.collection.isLoading=false;if($("#load-more-container").is(":hidden")){$("#options-table-1 tbody").empty()}$(".report-print").show();$(".report-print2").show();if(this.collection.size()==0){$(".report-print").hide();$(".report-print2").hide()}this.collection.each(this.renderOptions,this)},renderOptions:function(b){var a=new OptionsView({model:b});$("#options-table-1 tbody").append(a.render().el)},embdate:function(){$("#date1").datepicker({defaultDate:"+1w",changeMonth:true,changeYear:true,dateFormat:"yy-mm-dd",numberOfMonths:3,onClose:function(a){$("#date2").datepicker("option","minDate",a)}});$("#date2").datepicker({defaultDate:"+1w",changeMonth:true,changeYear:true,dateFormat:"yy-mm-dd",numberOfMonths:3,onClose:function(a){$("#date1").datepicker("option","maxDate",a)}})},monthpicker:function(){$(".monthPicker").datepicker({dateFormat:"MM-yy",changeMonth:true,changeYear:true,showButtonPanel:true,onClose:function(d,b){var c=$("#ui-datepicker-div .ui-datepicker-month :selected").val();var a=$("#ui-datepicker-div .ui-datepicker-year :selected").val();$(this).val($.datepicker.formatDate("MM-yy",new Date(a,c,1)))}});$(".monthPicker").focus(function(){$(".ui-datepicker-calendar").hide();$("#ui-datepicker-div").position({my:"center top",at:"center bottom",of:$(this)})})}});var AlertView=Backbone.View.extend({el:$("#alert-div"),template:$("#alertTemplate").html(),render:function(){var a=_.template(this.template);var b=Array;b.type=this.options.type;b.message=this.options.message;this.$el.html(a(b));return this}});
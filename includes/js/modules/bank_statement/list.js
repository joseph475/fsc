var crewModel=Backbone.Model.extend({defaults:{last_name:"",first_name:"",fullname:"",crew_id:0}});var crewMasterView=Backbone.View.extend({el:$("#options-list-view"),initialize:function(){this.collection.isLoading=false;this.collection.on("reset",this.render,this);this.collection.on("fetch",function(){this.collection.isLoading=true},this);if(this.collection.size()==0){e_model=new crewModel();this.collection.push(e_model)}this.collection.currentPage=0;this.collection.pager()},render:function(){var b=this;this.collection.isLoading=false;$("#dicen").empty();_.each(this.collection.models,function(a){var d=$("<option/>",{value:a.get("crew_id"),text:a.get("fullname")}).appendTo($("#dicen"))})}});var crewCollection=Backbone.Paginator.requestPager.extend({model:crewModel,vessel_id:0,paginator_core:{type:"GET",dataType:"json",url:BASE_URL+"api/crew_vessels?"},paginator_ui:{firstPage:1,currentPage:1,perPage:10000,sortField:"position_id",sortDir:"asc",searchField:null,searchVal:null,totalPages:10},server_api:{status:function(){return"Active"},vessel_id:function(){return this.vessel_id},limit:function(){return this.perPage},offset:function(){if(this.currentPage==0){this.currentPage=1}return(this.currentPage-1)*this.perPage},sort:function(){return this.sortField},order:function(){return this.sortDir},searchField:function(){return this.searchField},searchVal:function(){return this.searchVal}},parse:function(d){var c=d.data;this.totalPages=Math.floor(d._count/this.perPage);this.totalRecords=d._count;return c}});var BankModel=Backbone.Model.extend({defaults:{bs_id:0,payment:0,status:"",ispaid:false,date_terms:"00/00/0000",dt:"00/00/0000",last:true,first:true,container:""},url:function(){if(this.isNew()){return BASE_URL+"api/bank_statement_detail/"}else{return BASE_URL+"api/bank_statement_detail/id/"+this.get("id")}}});var BankCollection=Backbone.Collection.extend({model:BankModel,url:function(){return BASE_URL+"api/bank_statement_detail/id/"+this.bs_id},bs_id:0});var BankView=Backbone.View.extend({el:$("#options-list-view"),events:{"click #aub-submit":"saveCollection"},initialize:function(){this.render()},render:function(){var c=this;var d=[];this.collection.fetch({success:function(){_.each(c.collection.models,function(a){d.push(a)});if($(d).size()==0){e_model=new BankModel({bs_id:c.collection.bs_id});d.push(e_model);c.collection.push(e_model)}uvGroup=new CaaubGroupEditView({models:d,container:"aub",collection:c.collection})}})},saveCollection:function(f){var e=this;this.valid=true;if(this.valid){var d=0;_.each(this.collection.models,function(a){$(f.target).text("Saving...").attr("disabled",true);a.save("","",{success:function(){e.closeDialog(++d)},wait:true})},this);alert=new AlertView({type:"success",message:"New record successfully updated."});alert.render()}},closeDialog:function(b){if(b==this.collection.length){if(this.collection.container=="aub"){this.$el=$("#editaub")}else{if(this.collection.container=="ca"){this.$el=$("#editca")}}this.$el.modal("hide");$("#"+this.collection.container+"-submit").text("Submit Changes").attr("disabled",false)}}});var CaaubGroupEditView=Backbone.View.extend({tagName:"div",initialize:function(){this.render()},events:{"click .add-new":"addNew"},addNew:function(b){model=new BankModel({last:true,first:false,bs_id:this.collection.bs_id});this.options.models.push(model);this.collection.models.push(model);this.render()},render:function(){this.count=$(this.options.models).size();this.$el=$("#container-option-"+this.options.container);var b=this;this.$el.empty();$.each(this.options.models,function(e,f){if(e==0){f.set("first",true)}else{f.set("first",false)}if(e+1==b.count){f.set("last",true)}else{f.set("last",false)}var a=new BankItemEditView({model:f,collection:this.collection,container:b.options.container});b.$el.append(a.render().el)});return this}});var BankItemEditView=Backbone.View.extend({tagName:"div",events:{'change input[type!="radio"],select':"change","focus .ddate":"selectdate"},selectdate:function(){$(".ddate").datepicker({yearRange:"-10y:+10y",changeMonth:true,changeYear:true,showAnim:"clip"})},initialize:function(){var b=this;this.model.on("error",function(d,a){})},change:function(b){change={};change[$(b.target).attr("name")]=$(b.target).val();this.model.set(change,{silent:true});if($(b.target).attr("name")=="amount"){$(b.target).formatCurrency({symbol:""})}},render:function(){this.template=$("#option-"+this.options.container+"-template").html();var b=_.template(this.template);this.$el.html(b(this.model.toJSON()));return this}});var Options=Backbone.Model.extend({idAttribute:"id",url:function(){if(this.isNew()){return BASE_URL+"api/bank_statement"}else{return BASE_URL+"api/bank_statement/id/"+this.get("id")}},defaults:{crew_id:"",vessel_id:"",vessel_name:"",amount:"",fullname:"",type:0,di:"0000-00-00",code:"",position:"",hash:"",photo:"",row_number:0,nos:0}});var TypeAheadCollection=Backbone.Collection.extend({model:Options});var DirectoryView=Backbone.View.extend({el:$("#options-list-view"),initialize:function(){$(".sortcolumn").css("cursor","pointer");if(this.options.status_id==undefined){}this.collection.isLoading=false;this.collection.status_id=1;this.collection.on("add",this.renderOptions,this);this.collection.on("add",this.renderOptionsform,this);this.collection.on("reset",this.render,this);this.collection.on("fetch",function(){this.collection.isLoading=true;$("#loader-container").html('<img src="'+BASE_URL+'includes/img/ajax-loader.gif" />')},this);if(this.collection.size()==0){e_model=new Options({document:"",published:"",docs_nos:"",date_issued:"",date_expired:"",remarks:"",file_docs:"",docs_file:""});this.collection.push(e_model)}},events:{"shown a[data-toggle='tab']":"showStatus","click .sortcolumn":"updateSortBy","click #submit-search":"toggleSearch","click #loadmore-options":"loadMore","click .record-add":"addPost","focus .ddate":"selectdate","change #vessel_id":"crewSearch"},crewSearch:function(h){var e=this;var g=new crewCollection();g.vessel_id=$("#vessel_id").val();var f=new crewMasterView({collection:g})},addPost:function(h){h.preventDefault();var e=this;var g=new crewCollection();g.vessel_id=$("#vessel_id").val();var f=new crewMasterView({collection:g});$("#addData").live("show",function(){$(this).find(".btn-success").die().live("click",function(){var a=Array;$.map($(".inopts input, .inopts select, .inopts textarea").serializeArray(),function(b,c){a[b.name]=b.value});options=new Options();options.save(a,{success:function(b,d){this.$el=$("#addData");this.$el.modal("hide");if(d.status=="success"){alert=new AlertView({type:"success",message:"New record successfully added."})}else{var c="";$.each(d.message,function(l,k){$.each(k,function(i,j){c+=l+": "+j+"<br/>"})});alert=new AlertView({type:"error",message:c})}alert.render()},error:function(b,c){alert=new AlertView({type:"error",message:c});alert.render()}})})}).modal()},loadMore:function(b){this.collection.requestNextPage()},toggleSearch:function(b){$("#options-table-1 tbody").empty();this.collection.currentPage=1;this.collection.searchVal=$("#search").val();this.collection.pager()},updateSortBy:function(b){if(this.collection.sortDir=="desc"){dir="asc"}else{dir="desc"}this.collection.sortDir=String(dir);this.collection.updateOrder($(b.target).attr("col"))},showStatus:function(c){window.location.hash="/status/1";var d=this.collection;d.status_id=1;d.currentPage=0;d.pager()},render:function(){var b=this;$("#loader-container").empty();this.collection.isLoading=false;if($("#load-more-container").is(":hidden")){$("#options-table-1 tbody").empty()}if(this.collection.size()!=0){$("#options-table-1 tbody").empty()}this.collection.each(this.renderOptions,this);this.collection.each(this.renderOptionsform,this);$("#search").typeahead({source:function(f,e){queryAttributes={};queryAttributes.searchVal=f;var a=[];$.ajax({url:b.collection.paginator_core.url,data:queryAttributes,dataType:"json",success:function(c){typeAheadCollection=new TypeAheadCollection(c.data);return e(typeAheadCollection.pluck("fullname"))}})},minLength:4});$('[rel="clickover"]').clickover({placement:get_popover_placement,html:true})},renderOptions:function(c){var d=new OptionsView({model:c});$("#options-table-1 tbody").append(d.render().el)},renderOptionsform:function(d){var c=new OptionsForm({model:d});$("#container-option-add").append(c.render().el)},selectdate:function(){$(".ddate").datepicker({yearRange:"-10y:+10y",changeMonth:true,changeYear:true,showAnim:"clip"})}});var AlertView=Backbone.View.extend({el:$("#alert-div"),template:$("#alertTemplate").html(),render:function(){var d=_.template(this.template);var c=Array;c.type=this.options.type;c.message=this.options.message;this.$el.html(d(c));return this}});var OptionsView=Backbone.View.extend({tagName:"tr",template:$("#emp-list-item").html(),editTemplate:_.template($("#option-edit-template").html()),events:{"click .record-delete":"confirmDelete","click .record-edit":"editPost","click .record-aub":"editaub"},editPost:function(c){c.preventDefault();this.$el=$("#container-option-edit");var d=this;this.$el.empty();this.$el.html(this.editTemplate(this.model.toJSON()));$("#editData").live("show",function(){$(this).find(".btn-primary").die().live("click",function(){var a=Array;$.map($(".inopt input, .inopt select, .inopt textarea").serializeArray(),function(b,f){a[b.name]=b.value});d.model.save(a,{success:function(b,f){this.$el=$("#editData");this.$el.modal("hide");alert=new AlertView({type:"success",message:"Update success."});alert.render()},error:function(b,f){alert=new AlertView({type:"error",message:f});alert.render()}})})}).modal()},confirmDelete:function(c){c.preventDefault();var d=this;$("#deleteData").live("show",function(){$(this).find(".btn-danger").die().live("click",function(){d.model.destroy({success:function(a,b){d.remove()}})})}).modal()},editaub:function(g){g.preventDefault();var h=this;$("#container-option-aub").empty();var e=new BankCollection();e.bs_id=h.model.toJSON().id;e.container="aub";var f=new BankView({collection:e});$("#editaub").live("show",function(){}).modal()},render:function(){var b=_.template(this.template);this.$el.html(b(this.model.toJSON()));return this}});var OptionsForm=Backbone.View.extend({template:$("#container-option-add"),addTemplate:_.template($("#option-add-template").html()),render:function(){this.template.empty();this.template.html(this.addTemplate(this.model.toJSON()));return this}});var PaginatedView=Backbone.View.extend({events:{"click a.servernext":"nextResultPage","click a.serverprevious":"previousResultPage","click a.orderUpdate":"updateSortBy","click a.serverlast":"gotoLast","click a.page":"gotoPage","click a.serverfirst":"gotoFirst","click a.serverpage":"gotoPage","click .serverhowmany a":"changeCount"},tagName:"aside",template:_.template($("#tmpServerPagination").html()),initialize:function(){this.collection.on("reset",this.render,this);this.collection.on("change",this.render,this);this.$el.appendTo("#pagination")},render:function(){var b=this.template(this.collection.info());this.$el.html(b)},updateSortBy:function(c){c.preventDefault();var d=$("#sortByField").val();this.collection.updateOrder(d)},nextResultPage:function(b){b.preventDefault();this.collection.requestNextPage()},previousResultPage:function(b){b.preventDefault();this.collection.requestPreviousPage()},gotoFirst:function(b){b.preventDefault();this.collection.goTo(this.collection.information.firstPage)},gotoLast:function(b){b.preventDefault();this.collection.goTo(this.collection.information.lastPage)},gotoPage:function(c){c.preventDefault();var d=$(c.target).text();this.collection.goTo(d)},changeCount:function(c){c.preventDefault();var d=$(c.target).text();this.collection.howManyPer(d)}});var PaginatedCollection=Backbone.Paginator.requestPager.extend({model:Options,paginator_core:{type:"GET",dataType:"json",url:BASE_URL+"api/bank_statements?"},paginator_ui:{firstPage:1,currentPage:1,perPage:50,sortField:"date_issued",sortDir:"desc",searchField:null,searchVal:null,totalPages:10},server_api:{limit:function(){return this.perPage},offset:function(){if(this.currentPage==0){this.currentPage=1}return(this.currentPage-1)*this.perPage},sort:function(){return this.sortField},order:function(){return this.sortDir},searchField:function(){return this.searchField},searchVal:function(){return this.searchVal}},parse:function(d){var c=d.data;this.totalPages=Math.floor(d._count/this.perPage);this.totalRecords=d._count;return c}});
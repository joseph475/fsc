var DirectoryView=Backbone.View.extend({el:$("#options-list-view"),initialize:function(){$(".sortcolumn").css("cursor","pointer");if(this.options.status_id==undefined){this.options.status_id=$('a[data-toggle="tab"]:first').attr("dep")}this.collection.isLoading=false;this.collection.status_id=this.options.status_id;this.collection.on("add",this.renderOptions,this);this.collection.on("reset",this.render,this);this.collection.on("fetch",function(){this.collection.isLoading=true;$("#loader-container").html('<img src="'+BASE_URL+'includes/img/ajax-loader.gif" />')},this)},events:{"shown a[data-toggle='tab']":"showStatus","click .sortcolumn":"updateSortBy","click #submit-search":"toggleSearch","click #loadmore-options":"loadMore","click .record-save":"saveDocs"},saveDocs:function(c){var a=this;this.valid=true;_.each(this.collection.models,function(d){if(!d.isValid()){this.valid=false}},this);if(this.valid){var b=0;_.each(this.collection.models,function(d){$(c.target).text("Saving...").attr("disabled",false);d.save("","",{success:function(){alert=new AlertView({type:"success",message:"Update success."});alert.render()},error:function(f,e){alert=new AlertView({type:"error",message:e});alert.render()},wait:true});$(c.target).text("Save")},this)}},loadMore:function(a){this.collection.requestNextPage()},toggleSearch:function(a){$("#options-table-"+this.collection.status_id+" tbody").empty();this.collection.currentPage=1;this.collection.searchVal=$("#search").val();this.collection.pager()},updateSortBy:function(a){if(this.collection.sortDir=="desc"){dir="asc"}else{dir="desc"}this.collection.sortDir=String(dir);this.collection.updateOrder($(a.target).attr("col"))},showStatus:function(b){window.location.hash="/status/"+$(b.target).attr("dep");var a=this.collection;a.status_id=$(b.target).attr("dep");a.currentPage=0;a.pager();if(a.status_id==""){this.$el.find(".record-add").css("display","none")}else{this.$el.find(".record-add").css("display","inline")}},render:function(){var a=this;$("#loader-container").empty();this.collection.isLoading=false;if($("#load-more-container").is(":hidden")){$("#options-table-"+this.collection.status_id+" tbody").empty()}this.collection.each(this.renderOptions,this);$("#search").typeahead({source:function(c,d){queryAttributes={};queryAttributes.searchVal=c;var b=[];$.ajax({url:a.collection.paginator_core.url,data:queryAttributes,dataType:"json",success:function(e){typeAheadCollection=new TypeAheadCollection(e.data);return d(typeAheadCollection.pluck("option"))}})},minLength:4});$('[rel="clickover"]').clickover({placement:get_popover_placement,html:true})},renderOptions:function(b){var a=new OptionsView({model:b});$("#options-table-"+this.collection.status_id+" tbody").append(a.render().el)}});var AlertView=Backbone.View.extend({el:$("#alert-div"),template:$("#alertTemplate").html(),render:function(){var a=_.template(this.template);var b=Array;b.type=this.options.type;b.message=this.options.message;this.$el.html(a(b));return this}});